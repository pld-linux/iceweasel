diff -urN mozilla.orig/browser/confvars.sh mozilla/browser/confvars.sh
--- mozilla.orig/browser/confvars.sh	2010-02-04 15:47:13.000000000 +0100
+++ mozilla/browser/confvars.sh	2010-02-04 15:48:50.000000000 +0100
@@ -36,8 +36,8 @@
 #
 # ***** END LICENSE BLOCK *****
 
-MOZ_APP_BASENAME=Firefox
-MOZ_APP_VENDOR=Mozilla
+MOZ_APP_BASENAME=Iceweasel
+MOZ_APP_VENDOR=
 MOZ_UPDATER=1
 MOZ_PHOENIX=1
 
From: Mike Hommey <mh@glandium.org>
Date: Thu, 1 Apr 2010 15:34:59 +0200
Subject: Determine which phishing shavar to use depending on
 MOZ_OFFICIAL_BRANDING

---
 modules/libpref/src/Makefile.in | 4 ++++
 modules/libpref/src/init/all.js | 4 ++++
 2 files changed, 8 insertions(+)

diff --git a/modules/libpref/src/Makefile.in b/modules/libpref/src/Makefile.in
index 31333bc..e833ecd 100644
--- a/modules/libpref/src/Makefile.in
+++ b/modules/libpref/src/Makefile.in
@@ -7,6 +7,10 @@ DEFINES += -DOS_ARCH=$(OS_ARCH) \
            -DMOZ_WIDGET_TOOLKIT=$(MOZ_WIDGET_TOOLKIT) \
            $(NULL)
 
+ifdef MOZ_OFFICIAL_BRANDING
+DEFINES += -DMOZ_OFFICIAL_BRANDING
+endif
+
 include $(topsrcdir)/config/rules.mk
 
 GARBAGE		+= $(addprefix $(DIST)/bin/defaults/pref/, \
diff --git a/modules/libpref/src/init/all.js b/modules/libpref/src/init/all.js
index 24f1574..9c98f3e 100644
--- a/modules/libpref/src/init/all.js
+++ b/modules/libpref/src/init/all.js
@@ -4538,7 +4538,11 @@ pref("dom.inter-app-communication-api.enabled", false);
 
 // The tables used for Safebrowsing phishing and malware checks.
 pref("urlclassifier.malware_table", "goog-malware-shavar");
+#ifdef MOZ_OFFICIAL_BRANDING
 pref("urlclassifier.phish_table", "goog-phish-shavar");
+#else
+pref("urlclassifier.phish_table", "googpub-phish-shavar");
+#endif
 pref("urlclassifier.download_block_table", "");
 pref("urlclassifier.download_allow_table", "");
 
From: Mike Hommey <mh@glandium.org>
Date: Sat, 19 Feb 2011 11:04:53 +0100
Subject: Modify search plugins depending on MOZ_APP_NAME

---
 browser/locales/Makefile.in                     | 2 ++
 browser/locales/en-US/searchplugins/answers.xml | 2 +-
 browser/locales/en-US/searchplugins/google.xml  | 5 +++++
 3 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/browser/locales/Makefile.in b/browser/locales/Makefile.in
index 9b6fdee..e254d99 100644
--- a/browser/locales/Makefile.in
+++ b/browser/locales/Makefile.in
@@ -79,6 +79,8 @@ SEARCHPLUGINS_PATH := $(FINAL_TARGET)/searchplugins
 SEARCHPLUGINS := $(addsuffix .xml,$(SEARCHPLUGINS_NAMES))
 PP_TARGETS += SEARCHPLUGINS
 
+DEFINES += -DMOZ_APP_NAME=$(MOZ_APP_NAME)
+
 # Required for l10n.mk - defines a list of app sub dirs that should
 # be included in langpack xpis.
 ifdef MOZ_METRO
diff --git a/browser/locales/en-US/searchplugins/answers.xml b/browser/locales/en-US/searchplugins/answers.xml
index f131ea6..357d42e 100644
--- a/browser/locales/en-US/searchplugins/answers.xml
+++ b/browser/locales/en-US/searchplugins/answers.xml
@@ -12,6 +12,6 @@
   <Param name="gwp" value="13"/>
 </Url>
 <Url type="application/x-suggestions+json" method="GET"
-     template="http://www.answers.com/main/startswith?output=json&amp;client=firefox&amp;s={searchTerms}"/>
+#expand     template="http://www.answers.com/main/startswith?output=json&amp;client=__MOZ_APP_NAME__&amp;s={searchTerms}"/>
 <SearchForm>http://www.answers.com/</SearchForm>
 </SearchPlugin>
diff --git a/browser/locales/en-US/searchplugins/google.xml b/browser/locales/en-US/searchplugins/google.xml
index 668643f..cd56936 100644
--- a/browser/locales/en-US/searchplugins/google.xml
+++ b/browser/locales/en-US/searchplugins/google.xml
@@ -2,6 +2,7 @@
    - License, v. 2.0. If a copy of the MPL was not distributed with this
    - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
 
+#filter substitution
 <SearchPlugin xmlns="http://www.mozilla.org/2006/browser/search/">
 <ShortName>Google</ShortName>
 <Description>Google Search</Description>
@@ -14,6 +15,7 @@
   <Param name="oe" value="utf-8"/>
   <Param name="aq" value="t"/>
   <Param name="rls" value="{moz:distributionID}:{moz:locale}:{moz:official}"/>
+#if MOZ_APP_NAME==firefox
 #if MOZ_UPDATE_CHANNEL == beta
   <MozParam name="client" condition="defaultEngine" trueValue="firefox-beta" falseValue="firefox"/>
 #elif MOZ_UPDATE_CHANNEL == aurora
@@ -23,6 +25,9 @@
 #else
   <MozParam name="client" condition="defaultEngine" trueValue="firefox-a" falseValue="firefox"/>
 #endif
+#else
+  <MozParam name="client" condition="defaultEngine" trueValue="@MOZ_APP_NAME@-a" falseValue="@MOZ_APP_NAME@"/>
+#endif
   <MozParam name="channel" condition="purpose" purpose="contextmenu" value="rcs"/>
   <MozParam name="channel" condition="purpose" purpose="keyword" value="fflb"/>
   <MozParam name="channel" condition="purpose" purpose="searchbar" value="sb"/>
From: Mike Hommey <mh@glandium.org>
Date: Sat, 19 Feb 2011 11:02:30 +0100
Subject: Use MOZ_APP_DISPLAYNAME to fill appstrings.properties

---
 browser/locales/Makefile.in                          |  2 ++
 .../en-US/chrome/overrides/appstrings.properties     | 20 ++++++++++----------
 2 files changed, 12 insertions(+), 10 deletions(-)

diff --git a/browser/locales/Makefile.in b/browser/locales/Makefile.in
index 570485b..9b6fdee 100644
--- a/browser/locales/Makefile.in
+++ b/browser/locales/Makefile.in
@@ -29,6 +29,8 @@ SUBMAKEFILES += \
 	$(DEPTH)/$(MOZ_BRANDING_DIRECTORY)/locales/Makefile \
 	$(NULL)
 
+DEFINES += -DMOZ_APP_DISPLAYNAME=$(MOZ_APP_DISPLAYNAME)
+
 # This makefile uses variable overrides from the libs-% target to
 # build non-default locales to non-default dist/ locations. Be aware!
 
diff --git a/browser/locales/en-US/chrome/overrides/appstrings.properties b/browser/locales/en-US/chrome/overrides/appstrings.properties
index 1de0093..8c77825 100644
--- a/browser/locales/en-US/chrome/overrides/appstrings.properties
+++ b/browser/locales/en-US/chrome/overrides/appstrings.properties
@@ -3,24 +3,24 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 malformedURI=The URL is not valid and cannot be loaded.
-fileNotFound=Firefox can't find the file at %S.
-dnsNotFound=Firefox can't find the server at %S.
-protocolNotFound=Firefox doesn't know how to open this address, because the protocol (%S) isn't associated with any program.
-connectionFailure=Firefox can't establish a connection to the server at %S.
+#expand fileNotFound=__MOZ_APP_DISPLAYNAME__ can't find the file at %S.
+#expand dnsNotFound=__MOZ_APP_DISPLAYNAME__ can't find the server at %S.
+#expand protocolNotFound=__MOZ_APP_DISPLAYNAME__ doesn't know how to open this address, because the protocol (%S) isn't associated with any program.
+#expand connectionFailure=__MOZ_APP_DISPLAYNAME__ can't establish a connection to the server at %S.
 netInterrupt=The connection to %S was interrupted while the page was loading.
 netTimeout=The server at %S is taking too long to respond.
-redirectLoop=Firefox has detected that the server is redirecting the request for this address in a way that will never complete.
+#expand redirectLoop=__MOZ_APP_DISPLAYNAME__ has detected that the server is redirecting the request for this address in a way that will never complete.
 ## LOCALIZATION NOTE (confirmRepostPrompt): In this item, don't translate "%S"
 confirmRepostPrompt=To display this page, %S must send information that will repeat any action (such as a search or order confirmation) that was performed earlier.
 resendButton.label=Resend
-unknownSocketType=Firefox doesn't know how to communicate with the server.
+#expand unknownSocketType=__MOZ_APP_DISPLAYNAME__ doesn't know how to communicate with the server.
 netReset=The connection to the server was reset while the page was loading.
 notCached=This document is no longer available.
-netOffline=Firefox is currently in offline mode and can't browse the Web.
+#expand netOffline=__MOZ_APP_DISPLAYNAME__ is currently in offline mode and can't browse the Web.
 isprinting=The document cannot change while Printing or in Print Preview.
-deniedPortAccess=This address uses a network port which is normally used for purposes other than Web browsing. Firefox has canceled the request for your protection.
-proxyResolveFailure=Firefox is configured to use a proxy server that can't be found.
-proxyConnectFailure=Firefox is configured to use a proxy server that is refusing connections.
+#expand deniedPortAccess=This address uses a network port which is normally used for purposes other than Web browsing. __MOZ_APP_DISPLAYNAME__ has canceled the request for your protection.
+#expand proxyResolveFailure=__MOZ_APP_DISPLAYNAME__ is configured to use a proxy server that can't be found.
+#expand proxyConnectFailure=__MOZ_APP_DISPLAYNAME__ is configured to use a proxy server that is refusing connections.
 contentEncodingError=The page you are trying to view cannot be shown because it uses an invalid or unsupported form of compression.
 unsafeContentType=The page you are trying to view cannot be shown because it is contained in a file type that may not be safe to open. Please contact the website owners to inform them of this problem.
 externalProtocolTitle=External Protocol Request
