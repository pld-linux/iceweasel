--- a/js/src/gc/Memory.cpp.orig	2013-11-13 01:13:53.000000000 +0100
+++ a/js/src/gc/Memory.cpp	2013-11-28 05:03:31.160133711 +0100
@@ -63,7 +63,7 @@
         p = VirtualAlloc(NULL, size * 2, MEM_RESERVE, PAGE_READWRITE);
         if (!p)
             return NULL;
-        void *chunkStart = (void *)(uintptr_t(p) + (alignment - (uintptr_t(p) % alignment)));
+        void *chunkStart = (void *)AlignBytes(uintptr_t(p), alignment);
         UnmapPages(rt, p, size * 2);
         p = VirtualAlloc(chunkStart, size, MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE);
 
@@ -335,7 +335,7 @@
     uintptr_t offset = uintptr_t(region) % alignment;
     JS_ASSERT(offset < reqSize - size);
 
-    void *front = (void *)(uintptr_t(region) + (alignment - offset));
+    void *front = (void *)AlignBytes(uintptr_t(region), alignment);
     void *end = (void *)(uintptr_t(front) + size);
     if (front != region)
         JS_ALWAYS_TRUE(0 == munmap(region, alignment - offset));
